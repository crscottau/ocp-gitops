apiVersion: observability.openshift.io/v1
kind: ClusterLogForwarder
metadata:
  name: instance-rsyslog
  namespace: openshift-logging
  annotations:
    argocd.argoproj.io/sync-wave: "10"
    argocd.argoproj.io/sync-options: "SkipDryRunOnMissingResource=true"  
spec:
  outputs:
    - name: remote-rsyslog-audit
      syslog:
        url: 'tcp://192.168.124.1:30514'
        rfc: RFC5424
        facility: '23'
        appName: OCP
      type: syslog
    - name: remote-rsyslog-tekton
      syslog:
        url: 'tcp://192.168.124.1:30515'
        rfc: RFC5424
        facility: '23'
        appName: Tekton
      type: syslog      
  filters:
    - name: drop-get-list-watch
      type: drop
      drop:
        - test:
          - field: .verb
            matches: "get"
        - test:
          - field: .verb
            matches: "list"
        - test:
          - field: .verb
            matches: "watch"
        - test:
          - field: .username
            matches: "system:serviceaccount:.+?"  
        - test:
          - field: .user.username
            matches: "system:serviceaccount:.+?" 
     
  pipelines:
    #- name: forward-audit-to-remote
    #  inputRefs:
    #    - audit
    #  outputRefs:
    #    - remote-rsyslog-audit
    #  filterRefs:
    #    - drop-get-list-watch
    - name: forward-tekton-logs
      inputRefs:
        - tekton-logs-only
      outputRefs:
        - remote-rsyslog-tekton 
  inputs:
    - name: tekton-logs-only
      type: application    
      application:
        selector:
          matchLabels:
            tekton.dev/memberOf: tasks
  serviceAccount:
    name: cluster-logging-sa        